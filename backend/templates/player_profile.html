<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ player.first_name }} {{ player.last_name }} - Profile</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5 mb-5">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2>{{ player.first_name }} {{ player.last_name }}</h2>
            <p class="text-muted mb-0">Age: {{ player.age }}</p>
        </div>
        <a href="{{ url_for('index') }}" class="btn btn-outline-primary">‚Üê Back to Home</a>
    </div>

    <hr>

    {% if session_data %}
        <!-- Tabs Navigation -->
        <ul class="nav nav-tabs" id="sessionTabs" role="tablist">
            {% for session, results in session_data.items() %}
            <li class="nav-item" role="presentation">
                <button 
                    class="nav-link {% if loop.first %}active{% endif %}" 
                    id="tab-{{ session.session_id }}" 
                    data-bs-toggle="tab" 
                    data-bs-target="#content-{{ session.session_id }}" 
                    type="button" role="tab" 
                    aria-controls="content-{{ session.session_id }}" 
                    aria-selected="{{ 'true' if loop.first else 'false' }}">
                    {{ session.month }} {{ session.year }}
                </button>
            </li>
            {% endfor %}
        </ul>
<!-- Tabs Content -->
<div class="tab-content mt-3" id="sessionTabsContent">
    {% for session, results in session_data.items() %}
    <div 
        class="tab-pane fade {% if loop.first %}show active{% endif %}" 
        id="content-{{ session.session_id }}" 
        role="tabpanel" 
        aria-labelledby="tab-{{ session.session_id }}">
        
        {% if results %}
            <div class="table-responsive">
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Test</th>
                            <th>Score</th>
                            <th>Unit</th>
                            <th>Performance</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for result, test in results %}
                            {% set stats = session_stats[session][test.test_id] %}
                            {% set min_val = stats.worst %}
                            {% set max_val = stats.best %}
                            {% set avg_val = stats.avg %}
                            {% set player_val = result.score %}
                            {% if max_val != min_val %}
                                {% set player_pos = ((player_val - min_val) / (max_val - min_val)) * 100 %}
                                {% set avg_pos = ((avg_val - min_val) / (max_val - min_val)) * 100 %}
                            {% else %}
                                {% set player_pos = 50 %}
                                {% set avg_pos = 50 %}
                            {% endif %}

                            <tr>
                                <td>{{ test.test_name }}</td>
                                <td>{{ result.score }}</td>
                                <td>{{ test.unit }}</td>
                                <td>
                                    <div class="position-relative bg-light rounded" style="height: 20px;">
                                        <!-- Range bar -->
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar bg-success" role="progressbar" 
                                                 style="width: 100%; opacity: 0.2;"></div>
                                        </div>

                                        <!-- Average marker -->
                                        <div class="position-absolute top-0" 
                                             style="left: {{ avg_pos }}%; height: 20px; width: 2px; background: orange;"></div>

                                        <!-- Player marker -->
                                        <div class="position-absolute top-0" 
                                             style="left: {{ player_pos }}%; height: 20px; width: 3px; background: #0d6efd;"></div>
                                    </div>
                                    <div class="d-flex justify-content-between mt-1" style="font-size: 0.8em;">
                                        <span>Worst: {{ "%.2f"|format(min_val) }}</span>
                                        <span>Avg: {{ "%.2f"|format(avg_val) }}</span>
                                        <span>Best: {{ "%.2f"|format(max_val) }}</span>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="alert alert-info mt-4">
                No test results found for this player yet.
            </div>
        {% endif %}
    </div>
    {% endfor %}
</div>

    {% else %}
        <div class="alert alert-info mt-4">
            No test results found for this player yet.
        </div>
    {% endif %}
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
